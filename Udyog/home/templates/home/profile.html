<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profile â€¢ Udyog Refer</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] },
          colors: {
            ur: { blue: '#2563eb', blue600: '#2563eb', blue700: '#1d4ed8', blue800: '#1e40af' }
          },
          boxShadow: {
            soft: '0 3px 14px rgba(0,0,0,.06)',
            card: '0 8px 30px rgba(37,99,235,.08)'
          },
          borderRadius: { xl2: '1.25rem' }
        }
      }
    }
  </script>
  <style>
    /* Small helper so disabled things feel disabled */
    .is-disabled { pointer-events: none; opacity: .55; }
  </style>
</head>

<body class="bg-gray-100 font-sans text-[15px] text-gray-800 antialiased">
  <!-- ===== App Shell ===== -->
  <div class="flex min-h-screen">

    <!-- ========= Left Sidebar (fixed) ========= -->
    <aside class="w-20 bg-gradient-to-b from-ur.blue800 via-blue-900 to-slate-900 text-white fixed top-0 bottom-0 left-0 z-40">
      <div class="h-full flex flex-col items-center">
        <!-- Logo -->
        <a href="/" class="mt-6 mb-8">
          <div class="w-10 h-10 grid place-items-center bg-white/10 rounded-xl ring-1 ring-white/20 shadow">
            <span class="text-xs font-semibold">Ur</span>
          </div>
        </a>

        <!-- Nav Icons -->
        <nav class="flex-1 flex flex-col items-center justify-start gap-6 mt-2">
          <a href="/active_referals" class="p-3 rounded-full hover:bg-white/10 transition" title="Referrals">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M13 7a3 3 0 11-6 0 3 3 0 016 0z"></path><path fill-rule="evenodd" d="M2 13.5A4.5 4.5 0 016.5 9h7A4.5 4.5 0 0118 13.5V16a1 1 0 01-1 1H3a1 1 0 01-1-1v-2.5z" clip-rule="evenodd"></path></svg>
          </a>
          <a href="/tracker" class="p-3 rounded-full hover:bg-white/10 transition" title="Tracker">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M3 3a1 1 0 000 2h2a1 1 0 000-2H3zM3 7a1 1 0 000 2h6a1 1 0 100-2H3zM3 11a1 1 0 000 2h10a1 1 0 100-2H3zM3 15a1 1 0 100 2h14a1 1 0 100-2H3z"></path></svg>
          </a>
          <a href="/profile" class="p-3 rounded-full bg-white/15 ring-1 ring-white/20 transition" title="Profile">
            <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a4 4 0 00-4 4v1a4 4 0 108 0V6a4 4 0 00-4-4z"></path><path fill-rule="evenodd" d="M2 14a6 6 0 1116 0v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2z" clip-rule="evenodd"></path></svg>
          </a>
        </nav>

        <div class="mt-auto mb-4 text-[11px] text-white/60">Â© Udyog</div>
      </div>
    </aside>

    <!-- ========= Main Column ========= -->
    <div class="flex-1 ml-20 flex flex-col">

      <!-- Top Bar -->
      <header class="sticky top-0 z-30 bg-white/70 backdrop-blur border-b border-gray-200 px-6 py-4 flex items-center justify-between">
        <h1 class="text-[22px] font-semibold">My Profile</h1>
        <div class="flex items-center gap-3">
          <button class="p-2 rounded-full hover:bg-gray-200" title="Notifications">
            <svg class="w-5 h-5 text-gray-700" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
          </button>
          <button class="p-2 rounded-full hover:bg-gray-200" title="Account">
            <svg class="w-5 h-5 text-gray-700" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a4 4 0 00-4 4v1a4 4 0 108 0V6a4 4 0 00-4-4z"></path><path fill-rule="evenodd" d="M2 14a6 6 0 1116 0v2a2 2 0 01-2 2H4a2 2 0 01-2-2v-2z" clip-rule="evenodd"></path></svg>
          </button>
        </div>
      </header>

      <!-- Main Content -->
      <main class="flex-1 px-6 md:px-10 py-8">

        <div class="flex gap-8 items-start">
          <!-- ============ Left Profile Column (independent) ============ -->
          <section class="w-full md:w-[380px] lg:w-[400px] shrink-0">
            <!-- sticky keeps it independent of right column height -->
            <div class="sticky top-24">
              <div class="bg-white rounded-2xl shadow-card p-6 flex flex-col text-center">

                <!-- Avatar + Upload -->
                <div class="relative mx-auto">
                  <img id="profilePic" src="https://via.placeholder.com/160x160.png?text=Upload" class="w-36 h-36 rounded-full object-cover shadow-soft" alt="Profile Picture"/>
                  <button class="absolute bottom-1 right-1 p-2 bg-ur-blue text-white rounded-full shadow hover:bg-ur.blue700 transition"
                          title="Upload picture"
                          onclick="document.getElementById('uploadPic').click()">
                    <svg class="w-4 h-4" viewBox="0 0 20 20" fill="currentColor"><path d="M4 3a2 2 0 00-2 2v4h2V5h10v4h2V5a2 2 0 00-2-2H4z"></path><path d="M4 13v2a2 2 0 002 2h8a2 2 0 002-2v-2H4z"></path></svg>
                  </button>
                  <input id="uploadPic" type="file" accept="image/*" class="hidden" onchange="previewProfilePic(event)">
                </div>

                <!-- Name / Title / Quote (disabled until edit) -->
                <input id="inputName" class="mt-4 w-full border rounded-lg p-2.5 text-center font-semibold" placeholder="Your Name" disabled>
                <input id="inputTitle" class="-mt-1 w-full border rounded-lg p-2 text-center text-gray-600" placeholder="Your Role / Title" disabled>
                <input id="inputQuote" class="mt-3 w-full border rounded-lg p-2 text-center italic" placeholder="â€œAdd a short tagline or quote.â€" disabled>

                <!-- Education mini list (now supports multiple) -->
                <div class="mt-6 w-full text-left border-t pt-4">
                  <div class="flex items-center justify-between">
                    <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Education</h4>
                    <button id="btnAddEduMini" class="text-blue-600 text-sm hover:underline is-disabled" onclick="openEducationMiniModal()">+ Add</button>
                  </div>
                  <div id="eduMiniList" class="mt-3 space-y-3">
                    <!-- items injected -->
                  </div>
                </div>

                <!-- Social links (inputs only in edit mode) -->
                <div class="mt-5 text-left">
                  <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">Links</h4>
                  <div class="mt-2 grid grid-cols-1 gap-2">
                    <div class="flex items-center gap-3">
                      <div class="w-9 h-9 rounded-full grid place-items-center bg-gray-100 text-[#0a66c2]">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M4.98 3.5C4.98 4.88 3.88 6 2.5 6S0 4.88 0 3.5 1.12 1 2.5 1 4.98 2.12 4.98 3.5zM0 8.98h5V24H0V8.98zm7.5 0H12v2.05h.06c.63-1.2 2.17-2.47 4.47-2.47C21.4 8.56 24 11 24 15.24V24h-5v-7.6c0-1.82-.03-4.17-2.54-4.17-2.54 0-2.93 1.98-2.93 4.03V24H8V8.98z"/></svg>
                      </div>
                      <input id="linkLinkedIn" class="flex-1 border rounded-lg p-2" placeholder="https://linkedin.com/in/username" disabled>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-9 h-9 rounded-full grid place-items-center bg-gray-100 text-gray-900">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path fill-rule="evenodd" d="M12 2a10 10 0 00-3.162 19.49c.5.092.682-.217.682-.482 0-.237-.009-.868-.013-1.703-2.776.603-3.363-1.34-3.363-1.34-.454-1.154-1.11-1.462-1.11-1.462-.909-.622.069-.61.069-.61 1.004.071 1.531 1.032 1.531 1.032.892 1.529 2.341 1.087 2.91.832.092-.647.35-1.087.636-1.338-2.218-.253-4.553-1.109-4.553-4.943 0-1.091.39-1.985 1.029-2.684-.103-.254-.446-1.273.098-2.652 0 0 .84-.269 2.75 1.026A9.563 9.563 0 0112 6.844a9.55 9.55 0 012.504.337c1.909-1.295 2.748-1.026 2.748-1.026.546 1.379.203 2.398.1 2.652.64.699 1.028 1.593 1.028 2.684 0 3.842-2.338 4.687-4.565 4.936.36.31.679.921.679 1.856 0 1.34-.012 2.421-.012 2.751 0 .267.18.577.688.479A10 10 0 0012 2z" clip-rule="evenodd"/></svg>
                      </div>
                      <input id="linkGitHub" class="flex-1 border rounded-lg p-2" placeholder="https://github.com/username" disabled>
                    </div>
                    <div class="flex items-center gap-3">
                      <div class="w-9 h-9 rounded-full grid place-items-center bg-gray-100 text-pink-600">
                        <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 100 20 10 10 0 000-20zm4.83 6h-3.46a15.2 15.2 0 00-.94-3.16A8.01 8.01 0 0116.83 8zM12 4.1c.46.8.86 1.86 1.16 2.9H10.84c.3-1.04.7-2.1 1.16-2.9zM8.57 8a13.7 13.7 0 01.94-3.16A8.01 8.01 0 007.17 8h1.4zM6.1 10a14.2 14.2 0 010 4H4.1a8.02 8.02 0 010-4h2zm.07 6h1.4a13.7 13.7 0 01-.94 3.16A8.01 8.01 0 016.17 16zM12 19.9c-.46-.8-.86-1.86-1.16-2.9h2.32c-.3 1.04-.7 2.1-1.16 2.9zm3.43-3.9h1.4a8.01 8.01 0 01-2.34 3.16c.38-.97.7-2.05.94-3.16zM17.9 10a14.2 14.2 0 010 4h2a8.02 8.02 0 000-4h-2zm-1.07-2a13.7 13.7 0 01-.94-3.16A8.01 8.01 0 0117.83 8h-1.4zM8.57 16H7.17a8.01 8.01 0 002.34 3.16A13.7 13.7 0 018.57 16zM10.84 10h2.32a12.7 12.7 0 010 4h-2.32a12.7 12.7 0 010-4zM6.17 8h1.4a13.7 13.7 0 00-.94-3.16A8.01 8.01 0 006.17 8zM15.43 8h1.4a8.01 8.01 0 00-2.34-3.16c.38.97.7 2.05.94 3.16z"/></svg>
                      </div>
                      <input id="linkOther" class="flex-1 border rounded-lg p-2" placeholder="https://your.site/" disabled>
                    </div>
                  </div>
                </div>

                <!-- Edit Profile Button at bottom -->
                <div class="mt-6"></div>
                <button id="editToggle" class="mt-auto w-full py-2.5 text-sm rounded-lg shadow-soft bg-ur-blue text-white hover:bg-ur.blue700 transition"
                        onclick="toggleEditMode()">Edit Profile</button>
              </div>
            </div>
          </section>

          <!-- ============ Right Cards Column ============ -->
          <div class="flex-1 space-y-8">
            <!-- About -->
            <section class="bg-white rounded-2xl shadow-card p-6">
              <div class="flex items-center justify-between">
                <h3 class="text-sm font-semibold text-gray-500 uppercase tracking-wide">About</h3>
                <button id="btnEditAbout" class="text-blue-600 text-sm hover:underline is-disabled" onclick="openEditAbout()">âœŽ Edit About</button>
              </div>
              <textarea id="aboutArea" rows="5" class="w-full mt-2 border rounded-lg p-3 focus:ring-1 focus:ring-ur-blue" placeholder="Add a short summary..." disabled></textarea>
            </section>

            <!-- Skills -->
            <section class="bg-white rounded-2xl shadow-card p-6">
              <h3 class="text-sm font-semibold text-gray-500 uppercase mb-3">Skills</h3>
              <div id="skillsContainer" class="flex flex-wrap gap-2">
                <span class="text-gray-400 text-sm italic">No skills added yet.</span>
              </div>
              <button id="btnAddSkill" onclick="openAddSkillModal()" class="mt-3 text-blue-600 text-sm hover:underline is-disabled">+ Add Skill</button>
            </section>

            <!-- Experience -->
            <section class="bg-white rounded-2xl shadow-card p-6">
              <h3 class="text-sm font-semibold text-gray-500 uppercase mb-3">Professional Experience</h3>
              <div id="experienceContainer" class="space-y-4">
                <p class="text-gray-400 text-sm italic">No experience added yet.</p>
              </div>
              <button id="btnAddExp" onclick="openAddExperienceModal()" class="mt-3 text-blue-600 text-sm hover:underline is-disabled">+ Add New Experience</button>
            </section>

            <!-- Projects -->
            <section class="bg-white rounded-2xl shadow-card p-6">
              <h3 class="text-sm font-semibold text-gray-500 uppercase mb-3">Personal Projects</h3>
              <div id="projectsContainer" class="grid md:grid-cols-2 gap-4">
                <p class="text-gray-400 text-sm italic">No projects added yet.</p>
              </div>
              <button id="btnAddProj" onclick="openAddProjectModal()" class="mt-3 text-blue-600 text-sm hover:underline is-disabled">+ Add New Project</button>
            </section>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- ===== Sticky Save Bar ===== -->
  <div id="saveBar" class="hidden fixed bottom-6 right-8 z-50">
    <div class="bg-white shadow-card rounded-xl px-3 py-2 flex items-center gap-3 ring-1 ring-gray-200">
      <button class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300 text-sm" onclick="cancelEdit()">Cancel</button>
      <button class="px-4 py-2 rounded-md bg-ur-blue hover:bg-ur.blue700 text-white text-sm" onclick="saveAll()">ðŸ’¾ Save Changes</button>
    </div>
  </div>

  <!-- ===== Modals ===== -->

  <!-- About Modal (kept for parity; we also allow inline textarea in edit mode) -->
  <div id="aboutModal" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm grid place-items-center">
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-card p-6">
      <h3 class="text-lg font-semibold">Edit About</h3>
      <textarea id="aboutInput" rows="6" class="mt-3 w-full border rounded-lg p-3 focus:ring-1 focus:ring-ur-blue" placeholder="Write about yourself..."></textarea>
      <div class="mt-4 flex justify-end gap-3">
        <button class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300" onclick="closeModal('aboutModal')">Cancel</button>
        <button class="px-4 py-2 rounded-md bg-ur-blue text-white hover:bg-ur.blue700" onclick="applyAboutFromModal()">Apply</button>
      </div>
    </div>
  </div>

  <!-- Add Skill Modal -->
  <div id="skillModal" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm grid place-items-center">
    <div class="bg-white w-full max-w-md rounded-2xl shadow-card p-6">
      <h3 class="text-lg font-semibold">Add Skill</h3>
      <input id="skillInput" type="text" class="mt-3 w-full border rounded-lg p-2.5 focus:ring-1 focus:ring-ur-blue" placeholder="e.g., Django, React, GCP">
      <div class="mt-4 flex justify-end gap-3">
        <button class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300" onclick="closeModal('skillModal')">Cancel</button>
        <button class="px-4 py-2 rounded-md bg-ur-blue text-white hover:bg-ur.blue700" onclick="addSkill()">Add</button>
      </div>
    </div>
  </div>

  <!-- Add Experience Modal -->
  <div id="expModal" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm grid place-items-center">
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-card p-6">
      <h3 class="text-lg font-semibold">Add Experience</h3>
      <div class="grid md:grid-cols-2 gap-3 mt-3">
        <input id="expRole" class="border rounded-lg p-2.5" placeholder="Role / Designation (e.g., Data Analyst)">
        <input id="expCompany" class="border rounded-lg p-2.5" placeholder="Company (e.g., TCS)">
        <input id="expDuration" class="border rounded-lg p-2.5 md:col-span-2" placeholder="Duration (e.g., Jan 2025 â€“ Present)">
        <textarea id="expDesc" rows="4" class="border rounded-lg p-2.5 md:col-span-2" placeholder="What did you do?"></textarea>
      </div>
      <div class="mt-4 flex justify-end gap-3">
        <button class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300" onclick="closeModal('expModal')">Cancel</button>
        <button class="px-4 py-2 rounded-md bg-ur-blue text-white hover:bg-ur.blue700" onclick="addExperience()">Add</button>
      </div>
    </div>
  </div>

  <!-- Add Project Modal -->
  <div id="projModal" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm grid place-items-center">
    <div class="bg-white w-full max-w-2xl rounded-2xl shadow-card p-6">
      <h3 class="text-lg font-semibold">Add Project</h3>
      <div class="grid md:grid-cols-2 gap-3 mt-3">
        <input id="projName" class="border rounded-lg p-2.5" placeholder="Project Name">
        <input id="projLink" class="border rounded-lg p-2.5" placeholder="Link (https://)">
        <textarea id="projDesc" rows="4" class="border rounded-lg p-2.5 md:col-span-2" placeholder="Small brief..."></textarea>
      </div>
      <div class="mt-4 flex justify-end gap-3">
        <button class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300" onclick="closeModal('projModal')">Cancel</button>
        <button class="px-4 py-2 rounded-md bg-ur-blue text-white hover:bg-ur.blue700" onclick="addProject()">Add</button>
      </div>
    </div>
  </div>

  <!-- Tiny Education Add Modal (list on left) -->
  <div id="eduMiniModal" class="hidden fixed inset-0 z-50 bg-black/50 backdrop-blur-sm grid place-items-center">
    <div class="bg-white w-full max-w-xl rounded-2xl shadow-card p-6">
      <h3 class="text-lg font-semibold">Education (Summary)</h3>
      <div class="grid md:grid-cols-2 gap-3 mt-3">
        <input id="miniSchool" class="border rounded-lg p-2.5" placeholder="School / University">
        <input id="miniField" class="border rounded-lg p-2.5" placeholder="Field of study">
        <input id="miniAch" class="border rounded-lg p-2.5 md:col-span-2" placeholder="Achievements / Highlights">
      </div>
      <div class="mt-4 flex justify-end gap-3">
        <button class="px-4 py-2 rounded-md bg-gray-200 hover:bg-gray-300" onclick="closeModal('eduMiniModal')">Cancel</button>
        <button class="px-4 py-2 rounded-md bg-ur-blue text-white hover:bg-ur.blue700" onclick="addMiniEducation()">Add</button>
      </div>
    </div>
  </div>

  <!-- ================== App JS ================== -->
  <script>
    const STORE_KEY = 'ur_profile_v2';

    const defaultState = {
      name: '',
      title: '',
      quote: '',
      about: '',
      links: { linkedin: '', github: '', other: '' },
      profilePic: '',
      skills: [],
      experiences: [],
      projects: [],
      educationsMini: [] // {school, field, ach}
    };

    const $ = (id) => document.getElementById(id);

    function loadState(){
      try {
        const raw = localStorage.getItem(STORE_KEY);
        return raw ? JSON.parse(raw) : structuredClone(defaultState);
      } catch(e) { return structuredClone(defaultState); }
    }
    function saveState(){ localStorage.setItem(STORE_KEY, JSON.stringify(state)); }

    let state = loadState();
    let editMode = false;
    let snapshot = null;

    // ================= Renderers ==================
    function renderBasics(){
      $('inputName').value  = state.name || '';
      $('inputTitle').value = state.title || '';
      $('inputQuote').value = state.quote || '';
      $('aboutArea').value  = state.about || '';
      $('linkLinkedIn').value = state.links.linkedin || '';
      $('linkGitHub').value   = state.links.github   || '';
      $('linkOther').value    = state.links.other    || '';
      if(state.profilePic) $('profilePic').src = state.profilePic;
    }

    function renderSkills(){
      const c = $('skillsContainer');
      c.innerHTML = '';
      if(!state.skills?.length){
        c.innerHTML = `<span class="text-gray-400 text-sm italic">No skills added yet.</span>`;
        return;
      }
      state.skills.forEach((s, i) => {
        const chip = document.createElement('span');
        chip.className = 'px-2 py-1 bg-blue-100 text-blue-700 rounded-full text-xs flex items-center gap-1';
        chip.innerHTML = `<span>${s}</span><button class="hidden text-blue-700/70 hover:text-blue-900" data-role="del-skill" data-idx="${i}">&times;</button>`;
        if(editMode) chip.querySelector('[data-role="del-skill"]').classList.remove('hidden');
        chip.addEventListener('click', (e)=>{
          const btn = e.target.closest('[data-role="del-skill"]');
          if(btn && editMode){ state.skills.splice(+btn.dataset.idx,1); saveState(); renderSkills(); }
        });
        c.appendChild(chip);
      });
    }

    function renderExperiences(){
      const c = $('experienceContainer');
      c.innerHTML = '';
      if(!state.experiences?.length){
        c.innerHTML = `<p class="text-gray-400 text-sm italic">No experience added yet.</p>`;
        return;
      }
      state.experiences.forEach((e, i) => {
        const div = document.createElement('div');
        div.className = 'border border-gray-200 rounded-lg p-4 hover:border-ur-blue transition';
        div.innerHTML = `
          <div class="flex items-start justify-between gap-4">
            <div>
              <h4 class="font-medium text-gray-900">${e.role || 'Role'} â€” ${e.company || 'Company'}</h4>
              <p class="text-sm text-gray-500">${e.duration || ''}</p>
              <p class="text-sm text-gray-700 mt-1">${e.desc || ''}</p>
            </div>
            <button class="hidden text-red-500 text-sm hover:underline" data-role="del-exp" data-idx="${i}">Delete</button>
          </div>`;
        if(editMode) div.querySelector('[data-role="del-exp"]').classList.remove('hidden');
        div.addEventListener('click',(ev)=>{
          const b = ev.target.closest('[data-role="del-exp"]');
          if(b && editMode){ state.experiences.splice(+b.dataset.idx,1); saveState(); renderExperiences(); }
        });
        c.appendChild(div);
      });
    }

    function renderProjects(){
      const c = $('projectsContainer');
      c.innerHTML = '';
      if(!state.projects?.length){
        c.innerHTML = `<p class="text-gray-400 text-sm italic">No projects added yet.</p>`;
        return;
      }
      state.projects.forEach((p, i) => {
        const card = document.createElement('div');
        card.className = 'p-4 border border-gray-200 rounded-lg hover:border-ur-blue transition';
        const safeLink = p.link ? `<a class="text-sm text-blue-600 hover:underline mt-2 inline-block" href="${p.link}" target="_blank">View Project â†’</a>` : '';
        card.innerHTML = `
          <div class="flex items-start justify-between gap-4">
            <div>
              <h4 class="font-medium text-gray-900">${p.name || 'Project Name'}</h4>
              <p class="text-sm text-gray-700 mt-1">${p.desc || ''}</p>
              ${safeLink}
            </div>
            <button class="hidden text-red-500 text-sm hover:underline" data-role="del-proj" data-idx="${i}">Delete</button>
          </div>`;
        if(editMode) card.querySelector('[data-role="del-proj"]').classList.remove('hidden');
        card.addEventListener('click',(ev)=>{
          const b = ev.target.closest('[data-role="del-proj"]');
          if(b && editMode){ state.projects.splice(+b.dataset.idx,1); saveState(); renderProjects(); }
        });
        c.appendChild(card);
      });
    }

    function renderEduMini(){
      const list = $('eduMiniList');
      list.innerHTML = '';
      if(!state.educationsMini?.length){
        list.innerHTML = `<p class="text-gray-400 text-sm italic">No education added yet.</p>`;
        return;
      }
      state.educationsMini.forEach((ed, i)=>{
        const item = document.createElement('div');
        item.className = 'flex items-start gap-3';
        item.innerHTML = `
          <div class="mt-1 text-ur-blue">
            <svg class="w-4 h-4" viewBox="0 0 24 24" fill="currentColor"><path d="M12 3l9 4.5-9 4.5L3 7.5 12 3z"></path><path d="M21 14l-9 4.5L3 14v-4l9 4.5 9-4.5v4z"></path></svg>
          </div>
          <div class="flex-1">
            <p class="font-medium">${ed.school || 'School / University'}</p>
            <p class="text-sm text-gray-500">${ed.field || 'Field of Study'}</p>
            <p class="text-xs text-gray-400 italic">${ed.ach || ''}</p>
          </div>
          <button class="hidden text-red-500 text-sm hover:underline" data-role="del-edu" data-idx="${i}">Delete</button>`;
        if(editMode) item.querySelector('[data-role="del-edu"]').classList.remove('hidden');
        item.addEventListener('click',(ev)=>{
          const b = ev.target.closest('[data-role="del-edu"]');
          if(b && editMode){ state.educationsMini.splice(+b.dataset.idx,1); saveState(); renderEduMini(); }
        });
        list.appendChild(item);
      });
    }

    // ================= Edit Mode ==================
    function setInputsDisabled(disabled){
      ['inputName','inputTitle','inputQuote','aboutArea','linkLinkedIn','linkGitHub','linkOther'].forEach(id=>{
        const el=$(id);
        el.disabled = disabled;
      });
      // enable/disable add buttons
      ['btnAddSkill','btnAddExp','btnAddProj','btnAddEduMini','btnEditAbout'].forEach(id=>{
        const el=$(id);
        if(disabled) el.classList.add('is-disabled'); else el.classList.remove('is-disabled');
      });
    }

    function toggleEditMode(){
      editMode = !editMode;
      if(editMode){
        snapshot = JSON.parse(JSON.stringify(state)); // backup
        $('editToggle').textContent = 'Cancel Edit';
        $('saveBar').classList.remove('hidden');
        setInputsDisabled(false);
        renderSkills(); renderExperiences(); renderProjects(); renderEduMini();
      } else {
        state = JSON.parse(JSON.stringify(snapshot)); // restore
        renderAll();
        $('saveBar').classList.add('hidden');
        $('editToggle').textContent = 'Edit Profile';
        setInputsDisabled(true);
      }
    }

    function cancelEdit(){
      editMode=false;
      state = JSON.parse(JSON.stringify(snapshot));
      renderAll();
      $('saveBar').classList.add('hidden');
      $('editToggle').textContent = 'Edit Profile';
      setInputsDisabled(true);
      toast('Cancelled');
    }

    function saveAll(){
      // Pull values from inputs
      state.name  = $('inputName').value.trim();
      state.title = $('inputTitle').value.trim();
      state.quote = $('inputQuote').value.trim();
      state.about = $('aboutArea').value.trim();
      state.links.linkedin = $('linkLinkedIn').value.trim();
      state.links.github   = $('linkGitHub').value.trim();
      state.links.other    = $('linkOther').value.trim();

      saveState();
      editMode=false;
      $('saveBar').classList.add('hidden');
      $('editToggle').textContent = 'Edit Profile';
      setInputsDisabled(true);
      renderAll();
      toast('Saved successfully');
    }

    // ================= Modals / Actions ==================
    function openEditAbout(){ if(!editMode) return; $('aboutInput').value=$('aboutArea').value; $('aboutModal').classList.remove('hidden'); }
    function applyAboutFromModal(){ $('aboutArea').value = $('aboutInput').value; closeModal('aboutModal'); }
    function openAddSkillModal(){ if(!editMode) return; $('skillModal').classList.remove('hidden'); }
    function openAddExperienceModal(){ if(!editMode) return; $('expModal').classList.remove('hidden'); }
    function openAddProjectModal(){ if(!editMode) return; $('projModal').classList.remove('hidden'); }
    function openEducationMiniModal(){ if(!editMode) return; $('eduMiniModal').classList.remove('hidden'); }
    function closeModal(id){ $(id).classList.add('hidden'); }

    function addSkill(){
      const v = $('skillInput').value.trim();
      if(!v) return;
      (state.skills ||= []).push(v);
      $('skillInput').value='';
      saveState(); renderSkills(); closeModal('skillModal');
    }

    function addExperience(){
      const e = {
        role: $('expRole').value.trim(),
        company: $('expCompany').value.trim(),
        duration: $('expDuration').value.trim(),
        desc: $('expDesc').value.trim()
      };
      if(!e.role && !e.company) return;
      (state.experiences ||= []).push(e);
      saveState(); renderExperiences(); closeModal('expModal');
      $('expRole').value=$('expCompany').value=$('expDuration').value=$('expDesc').value='';
    }

    function addProject(){
      const p = {
        name: $('projName').value.trim(),
        link: $('projLink').value.trim(),
        desc: $('projDesc').value.trim()
      };
      if(!p.name) return;
      (state.projects ||= []).push(p);
      saveState(); renderProjects(); closeModal('projModal');
      $('projName').value=$('projLink').value=$('projDesc').value='';
    }

    function addMiniEducation(){
      const ed = {
        school: $('miniSchool').value.trim(),
        field:  $('miniField').value.trim(),
        ach:    $('miniAch').value.trim()
      };
      if(!ed.school) return;
      (state.educationsMini ||= []).push(ed);
      saveState(); renderEduMini(); closeModal('eduMiniModal');
      $('miniSchool').value=$('miniField').value=$('miniAch').value='';
    }

    // ================= Avatar ==================
    function previewProfilePic(e){
      const f = e.target.files[0]; if(!f) return;
      const reader = new FileReader();
      reader.onload = (ev)=>{ state.profilePic = ev.target.result; saveState(); $('profilePic').src=state.profilePic; }
      reader.readAsDataURL(f);
    }

    // ================= Utilities ==================
    function toast(text){
      const box = document.createElement('div');
      box.className = 'fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900 text-white px-4 py-2 rounded-lg shadow';
      box.textContent = text;
      document.body.appendChild(box);
      setTimeout(()=> box.remove(), 1400);
    }

    function renderAll(){
      renderBasics();
      renderSkills();
      renderExperiences();
      renderProjects();
      renderEduMini();
    }

    // Init
    renderAll();
    setInputsDisabled(true);
  </script>
</body>
</html>
