<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>What‚Äôs Hot Now</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Lottie for ‚Äúcoming soon‚Äù modal -->
  <script src="https://unpkg.com/@lottiefiles/lottie-player@latest/dist/lottie-player.js"></script>




  <!-- JWT guard + auth fetch (ONE token only) -->
  <script>
    const token = localStorage.getItem("access_token");

    (async () => {
      if (!token) return (window.location.href = "/no_token");
      try {
        const res = await fetch("/api/protected-ping/", {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) window.location.href = "/no_token";
      } catch {
        window.location.href = "/no_token";
      }
    })();

    function authFetch(url, options = {}) {
      const headers = { ...(options.headers || {}) };
      if (token) headers.Authorization = `Bearer ${token}`;
      return fetch(url, { ...options, headers });
    }
  </script>

  <!-- Tiny CSS for the glowing Personal Assist button -->
  <style>
    @keyframes paPulse {
      0%   { box-shadow: 0 0 0 0 rgba(59,130,246,.45); }
      70%  { box-shadow: 0 0 0 10px rgba(59,130,246,0); }
      100% { box-shadow: 0 0 0 0 rgba(59,130,246,0); }
    }
    .pa-glow {
      animation: paPulse 2s infinite;
    }
  </style>
</head>

<body class="bg-gray-100 font-sans">
  <div class="flex min-h-screen">

    <!-- LEFT SIDEBAR (exact look you asked for) -->
    <aside class="w-20 bg-gradient-to-b from-blue-800 via-blue-900 to-slate-900 text-white flex flex-col items-center py-6 fixed top-0 bottom-0">
      <div class="flex-1 flex flex-col justify-center space-y-6">
        <!-- Active Referrals Icon -->
        <a href="{% url 'active_referals' %}" class="relative group">
          <div class="p-3 rounded-full hover:bg-gray-700 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.235v-.11a6.375 6.375 0 0 1 12.75 0v.109A12.318 12.318 0 0 1 9.374 21c-2.331 0-4.512-.645-6.374-1.766Z" />
</svg>

              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14c-4 0-8 2-8 4v2h16v-2c0-2-4-4-8-4z"/>
            </svg>
          </div>
        </a>

        <!-- What's Hot Now Icon (active) -->
        <a href="{% url 'trending' %}" class="relative group">
          <div class="p-3 rounded-full bg-gray-800 ring-2 ring-white">
            <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" stroke-width="2"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
        </a>

        <!-- My Tracker Icon -->
        <a href="{% url 'tracker' %}" class="relative group">
          <div class="p-3 rounded-full hover:bg-gray-700 transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 0 1 3 19.875v-6.75ZM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V8.625ZM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 0 1-1.125-1.125V4.125Z" />
</svg>

          </div>
        </a>
      </div>
    </aside>

    <!-- CONTENT (offset for sidebar) -->
    <div class="flex-1 ml-20 flex flex-col">

      <!-- TOP BAR -->
      <header class="sticky top-0 z-10 bg-gray-100 border-b">
        <div class="max-w-6xl mx-auto px-6 py-4 grid grid-cols-[1fr_auto_1fr] items-center gap-4">
          <!-- Left: title -->
          <div class="justify-self-start">
            <h1 class="text-2xl font-bold text-blue-900">What‚Äôs Hot Now</h1>
            <p class="text-gray-600 text-sm -mt-0.5">What‚Äôs trending in career space?</p>
          </div>

          <!-- Center: pills -->
          <nav class="justify-self-center flex items-center gap-3 flex-wrap">
            <button class="px-4 py-2 rounded-full bg-blue-800 text-white text-sm font-medium">üÜï Fresh Jobs</button>
            <button onclick="openComingSoon('Hackathons')" class="px-4 py-2 rounded-full border text-blue-800 text-sm font-medium hover:bg-blue-50">üèÜ Hackathons</button>
            <button onclick="openComingSoon('Hiring News')" class="px-4 py-2 rounded-full border text-blue-800 text-sm font-medium hover:bg-blue-50">üì£ Hiring News</button>
            <button onclick="openComingSoon('Trending Companies')" class="px-4 py-2 rounded-full border text-blue-800 text-sm font-medium hover:bg-blue-50">üìà Trending Cos</button>
          </nav>

          <!-- Right: Personal Assist (glow) + Settings + Logout -->
          <div class="justify-self-end flex items-center gap-3">

            <!-- Personal Assist trigger -->
            <button type="button" onclick="openPAModal()" aria-label="Open Personal Assist"
                    class="relative p-2 rounded hover:bg-gray-200 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-500">
              <span class="absolute inset-0 rounded-full pa-glow pointer-events-none"></span>
              <svg class="relative w-6 h-6 text-gray-700" viewBox="0 0 24 24" fill="none"
                   stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M12 6v.01M16.24 7.76v.01M18 12v.01M16.24 16.24v.01M12 18v.01M7.76 16.24v.01M6 12v.01M7.76 7.76v.01" />
                <circle cx="12" cy="12" r="3" />
              </svg>
            </button>

          <!-- User Profile Icon and Trigger button -->
          <div class="relative">
          <button onclick="toggleProfileModal()"
                  class="p-2 rounded hover:bg-gray-200 focus:outline-none"
                  aria-label="User Profile">
            <svg xmlns="http://www.w3.org/2000/svg" 
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                class="w-6 h-6 text-gray-700">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" />
            </svg>
          </button>

          <!-- Profile Modal -->
          <div id="profileModal"
              class="hidden absolute right-0 mt-2 w-56 bg-white border border-gray-200 rounded-lg shadow-lg">
            <div class="px-4 py-3 border-b">
              <p id="displayName" class="font-semibold text-gray-800">User</p>  
              <p id="displayEmail" class="text-sm text-gray-500">email@domain.com</p>

            </div>
            <ul class="py-2 text-sm text-gray-700">
              <li><a href="#" class="block px-4 py-2 hover:bg-gray-100">View Profile</a></li>
              <li><a href="#" class="block px-4 py-2 hover:bg-gray-100">See Plans</a></li>
              <li><a href="#" class="block px-4 py-2 hover:bg-gray-100">Help</a></li>
              <li><a href="#" class="block px-4 py-2 hover:bg-gray-100">Language</a></li>
              <li><a href="#" class="block px-4 py-2 hover:bg-gray-100">Privacy</a></li>
              <li><a href="#" class="block px-4 py-2 hover:bg-gray-100">Data Policy</a></li>
            </ul>
            <div class="border-t">
              <a href="{% url 'login' %}" class="block px-4 py-2 text-sm text-red-600 hover:bg-gray-100">Sign Out</a>
            </div>
          </div>
          </div>



            <!-- Logout -->
            <a href="{% url 'login' %}" class="p-2 rounded hover:bg-gray-200" aria-label="Logout">
              <svg class="w-6 h-6 text-gray-700 hover:text-red-600" fill="none" stroke="currentColor" stroke-width="2"
                   viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a2 2 0 01-2 2H7a2 2 0 01-2-2V7a2 2 0 012-2h4a2 2 0 012 2v1"/>
              </svg>
            </a>
          </div>
        </div>
      </header>

      <!-- MAIN: left scrollable / right fixed -->
      <main class="px-6 py-6">
        <div class="max-w-6xl mx-auto grid grid-cols-12 gap-6 h-[calc(100vh-10rem)] overflow-hidden">

          <!-- LEFT (filters + list) -->
          <section class="col-span-12 lg:col-span-4 h-full overflow-y-auto pr-2">
            <!-- Filters -->
            <div class="sticky top-0 z-10 bg-gray-100/95 rounded-lg border border-gray-200 px-3 py-3 mb-4">
              <div class="flex items-center gap-3">
                <div class="flex-1 flex items-center gap-2 bg-white border rounded-full px-3 py-2 shadow-sm">
                  <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2"
                       viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
                       d="M21 21l-4.35-4.35M11 18a7 7 0 110-14 7 7 0 010 14z"/></svg>
                  <input id="kwInput" type="text" placeholder="Keyword search"
                         class="w-full outline-none text-sm placeholder-gray-400 bg-transparent"/>
                </div>
                <div class="flex-1 flex items-center gap-2 bg-white border rounded-full px-3 py-2 shadow-sm">
                  <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" stroke-width="2"
                       viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round"
                       d="M12 11c1.657 0 3-1.567 3-3.5S13.657 4 12 4 9 5.567 9 7.5 10.343 11 12 11z"/><path
                       stroke-linecap="round" stroke-linejoin="round"
                       d="M19.5 7.5c0 5-7.5 12-7.5 12S4.5 12.5 4.5 7.5a7.5 7.5 0 1115 0z"/></svg>
                  <input id="locInput" type="text" placeholder="Location"
                         class="w-full outline-none text-sm placeholder-gray-400 bg-transparent"/>
                </div>
                <button id="filterBtn"
                        class="px-4 py-2 rounded-full bg-blue-600 text-white text-sm font-medium hover:bg-blue-700">Search</button>
                <button id="resetBtn"
                        class="px-4 py-2 rounded-full border text-sm hover:bg-gray-50">Reset</button>
              </div>
            </div>

            <!-- Job list -->
            <div id="jobList" class="space-y-4"></div>

            <!-- Bottom pagination -->
            <div class="mt-5">
              <div class="bg-gray-100/95 rounded-lg border border-gray-200 px-3 py-3">
                <nav id="pager" class="flex items-center justify-center gap-2 flex-wrap select-none"></nav>
              </div>
            </div>
          </section>

          <!-- RIGHT (detail, not scrollable) -->
          <aside class="col-span-12 lg:col-span-8 h-full">
            <div id="jobDetail" class="bg-white shadow rounded-lg border border-gray-200 p-6 h-full">
              <div id="detailEmpty" class="h-full flex items-center justify-center text-center text-gray-500">
                <div>
                  <div class="text-lg font-semibold text-gray-800">Select a job to view details</div>
                  <div class="text-sm">Click any card on the left.</div>
                </div>
              </div>
              <div id="detailBody" class="hidden h-full flex flex-col gap-5">
                <div>
                  <h2 id="dTitle" class="text-2xl lg:text-3xl font-bold text-blue-900"></h2>
                  <p id="dMeta"  class="text-sm text-gray-500 mt-1"></p>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                  <div class="bg-blue-50 text-blue-900 border border-blue-100 rounded-md px-4 py-3">
                    <span class="text-xs uppercase tracking-wide">Company</span>
                    <div id="dCompany" class="font-medium"></div>
                  </div>
                  <div class="bg-blue-50 text-blue-900 border border-blue-100 rounded-md px-4 py-3">
                    <span class="text-xs uppercase tracking-wide">Location</span>
                    <div id="dLocation" class="font-medium"></div>
                  </div>
                </div>
                <div class="flex-1">
                  <h3 class="text-sm font-semibold text-gray-700">Job Description</h3>
                  <p id="dDesc" class="text-gray-800 mt-2 leading-relaxed"></p>
                </div>
                <div class="flex items-center gap-3">
                  <a id="dApply" href="#" target="_blank"
                     class="inline-flex items-center justify-center px-4 py-2 rounded-md bg-blue-600 text-white text-sm font-medium hover:bg-blue-700">Apply Now</a>
                  <button class="px-4 py-2 rounded-md border text-sm hover:bg-gray-50">Save</button>
                  <button class="px-4 py-2 rounded-md border text-sm hover:bg-gray-50">Share</button>
                </div>
              </div>
            </div>
          </aside>

        </div>
      </main>
    </div>
  </div>

  <!-- Coming Soon Modal (for Hackathons / Hiring News / Trending Cos) -->
  <div id="comingModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-6 w-full max-w-md text-center shadow-lg relative">
      <button onclick="closeComingSoon()" class="absolute top-3 right-3 text-gray-400 hover:text-gray-600" aria-label="Close">‚úï</button>
      <lottie-player
        src="https://assets3.lottiefiles.com/packages/lf20_jcikwtux.json"
        background="transparent" speed="1"
        style="width: 200px; height: 200px; margin: auto;"
        loop autoplay>
      </lottie-player>
      <h2 class="text-xl font-bold text-gray-800 mt-4" id="comingTitle">We‚Äôre building this feature!</h2>
      <p id="comingMsg" class="text-gray-600 text-sm mt-2">This feature is under active development. Stay tuned!</p>
    </div>
  </div>

  <!-- Personal Assist Modal (your AI chat UI) -->
  <div id="paModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center z-50">
    <div class="w-[360px] rounded-2xl overflow-hidden shadow-xl bg-white border border-slate-200 relative">
      <!-- close -->
      <button onclick="closePAModal()" class="absolute top-3 right-3 z-10 text-white/80 hover:text-white" aria-label="Close">‚úï</button>

      <!-- header -->
      <div class="bg-gradient-to-b from-slate-900 to-black text-white px-5 py-4">
        <h2 class="font-semibold text-lg flex items-center gap-2">ü§ñ AI Assistant</h2>
      </div>

      <!-- body -->
      <div id="chatPA" class="bg-gradient-to-b from-slate-950 to-slate-900 text-slate-100 h-[420px] px-4 py-4 space-y-3 overflow-y-auto">
        <div class="flex">
          <div class="max-w-[80%] bg-slate-800/70 rounded-xl px-3 py-2 text-sm">
            üëã Hey! I‚Äôm your AI career buddy ‚Äî tracking jobs, trends, and apps across Udyog, WhatsApp, Insta & more.
I learn from your resume, LinkedIn & beyond to guide your growth.
Find peers, build projects, join hackathons ‚Äî level up together.
And we're just getting started. Currently under development ‚öôÔ∏è.....

          </div>
          
        </div>
      </div>

      <!-- input bar -->
      <div class="bg-black/95 p-3 flex items-center gap-2">
        <input id="msgPA" type="text"
               class="flex-1 bg-slate-800/70 text-slate-100 placeholder-slate-400 rounded-xl px-3 py-2 outline-none border border-slate-700 focus:border-slate-500"
               placeholder="Type a message..." />
        <button id="sendPA"
                class="shrink-0 bg-white text-black rounded-xl px-3 py-2 font-medium hover:opacity-90 active:scale-95 transition">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-6">
  <path stroke-linecap="round" stroke-linejoin="round" d="M6 12 3.269 3.125A59.769 59.769 0 0 1 21.485 12 59.768 59.768 0 0 1 3.27 20.875L5.999 12Zm0 0h7.5" />
</svg>

        </button>
      </div>
    </div>
  </div>



  <!--Start of JS Functions-->
  <!-- Dynamic JS -->
  <script>
    /* ========= Modals ========= */
    function openComingSoon(feature){
      document.getElementById('comingTitle').textContent = `‚Äú${feature}‚Äù is coming soon!`;
      document.getElementById('comingMsg').textContent   = `We‚Äôre building ${feature}. Thanks for your patience.`;
      const m = document.getElementById('comingModal');
      m.classList.remove('hidden'); m.classList.add('flex');
    }
    function closeComingSoon(){
      const m = document.getElementById('comingModal');
      m.classList.add('hidden'); m.classList.remove('flex');
    }

    function openPAModal(){
      const m = document.getElementById('paModal');
      m.classList.remove('hidden'); m.classList.add('flex');
      document.getElementById('msgPA').focus();
    }
    function closePAModal(){
      const m = document.getElementById('paModal');
      m.classList.add('hidden'); m.classList.remove('flex');
    }
    // close on ESC
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') { closePAModal(); closeComingSoon(); }
    });

    /* ========= Jobs List (server-driven) ========= */
    const API_URL   = "/api/jobs/";   // change if needed
    const PAGE_SIZE = 5;

    let page = 1, keyword = "", locationStr = "";

    const jobList    = document.getElementById('jobList');
    const pager      = document.getElementById('pager');
    const kwInput    = document.getElementById('kwInput');
    const locInput   = document.getElementById('locInput');
    const filterBtn  = document.getElementById('filterBtn');
    const resetBtn   = document.getElementById('resetBtn');

    const detailEmpty= document.getElementById('detailEmpty');
    const detailBody = document.getElementById('detailBody');
    const dTitle     = document.getElementById('dTitle');
    const dMeta      = document.getElementById('dMeta');
    const dCompany   = document.getElementById('dCompany');
    const dLocation  = document.getElementById('dLocation');
    const dDesc      = document.getElementById('dDesc');
    const dApply     = document.getElementById('dApply');

    function buildURL(){
      const url = new URL(API_URL, window.location.origin);
      if (keyword)     url.searchParams.set("search", keyword);     // DRF SearchFilter
      if (locationStr) url.searchParams.set("location", locationStr);
      url.searchParams.set("page", page);
      url.searchParams.set("page_size", PAGE_SIZE);
      return url.toString();
    }

    function skeletonList(n=3){
      jobList.innerHTML = Array.from({length:n}).map(()=>`
        <div class="bg-white rounded-lg p-5 shadow animate-pulse">
          <div class="h-4 w-1/2 bg-gray-200 rounded mb-2"></div>
          <div class="h-3 w-1/3 bg-gray-200 rounded mb-4"></div>
          <div class="h-3 w-5/6 bg-gray-200 rounded"></div>
        </div>
      `).join("");
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }

    // Map API fields here if names differ
    function jobItemTemplate(j){
      const title   = j.title || j.role_title || "Untitled Role";
      const company = j.company || j.company_name || "‚Äî";
      const loc     = j.location || j.city || "‚Äî";
      const when    = j.posted_ago || j.age || "";   // e.g., "1d ago"
      const snippet = j.snippet || j.description_short || "";
      const apply   = j.apply_url || "#";

      return `
        <article class="job-card bg-white shadow rounded-lg p-5 border-l-4 border-blue-800 cursor-pointer hover:shadow-md transition"
          data-title="${escapeHtml(title)}"
          data-meta="${escapeHtml(loc)}${when ? ' ¬∑ '+escapeHtml(when) : ''}"
          data-desc="${escapeHtml(snippet)}"
          data-location="${escapeHtml(loc)}"
          data-company="${escapeHtml(company)}"
          data-apply="${apply}">
          <h3 class="text-base font-semibold text-blue-900">${title}</h3>
          <p class="text-gray-600 mt-1 text-sm">${loc}${when ? ' | '+when : ''}</p>
          <p class="text-sm mt-2 text-gray-700 line-clamp-2">${snippet}</p>
        </article>
      `;
    }

    function bindListClicks(){
      jobList.querySelectorAll('.job-card').forEach(card=>{
        card.addEventListener('click', ()=>{
          dTitle.textContent    = card.dataset.title;
          dMeta.textContent     = card.dataset.meta;
          dCompany.textContent  = card.dataset.company;
          dLocation.textContent = card.dataset.location;
          dDesc.textContent     = card.dataset.desc;
          dApply.href           = card.dataset.apply || '#';

          detailEmpty.classList.add('hidden');
          detailBody.classList.remove('hidden');

          document.querySelectorAll('.job-card').forEach(c=>c.classList.remove('ring','ring-blue-300'));
          card.classList.add('ring','ring-blue-300');
        });
      });
    }

    function renderPager(totalCount){
      const totalPages = Math.max(1, Math.ceil((totalCount || 0) / PAGE_SIZE));
      const maxButtons = 5;
      const start = Math.max(1, page - Math.floor(maxButtons/2));
      const end   = Math.min(totalPages, start + maxButtons - 1);

      const btn = (label,target,disabled=false,active=false)=>`
        <button data-page="${target}" ${disabled ? "disabled" : ""}
          class="px-3 py-1 rounded-md border text-sm
                 ${active ? 'bg-blue-600 text-white border-blue-600' : 'hover:bg-gray-50'}
                 ${disabled ? 'opacity-50 cursor-not-allowed' : ''}">
          ${label}
        </button>`;
      let html = '';
      html += btn('‚Äπ', Math.max(1, page-1), page===1);
      for (let p=start; p<=end; p++) html += btn(p, p, false, p===page);
      html += btn('‚Ä∫', page+1, page===totalPages);
      pager.innerHTML = html;
    }

    async function loadJobs(){
      skeletonList();
      try{
        const res = await authFetch(buildURL());
        if (res.status === 401) { window.location.href = "/no_token"; return; }
        const data = await res.json();

        const items = Array.isArray(data) ? data : (data.results || []);
        const count = Array.isArray(data) ? items.length : (data.count ?? items.length);

        if (!items.length){
          jobList.innerHTML = `<div class="text-center text-gray-500">No jobs found.</div>`;
          renderPager(0);
          return;
        }

        jobList.innerHTML = items.map(jobItemTemplate).join("");
        bindListClicks();
        renderPager(count);
      } catch(e){
        jobList.innerHTML = `<div class="text-red-600">Failed to load jobs.</div>`;
        pager.innerHTML = "";
      }
    }

    // Personal Assist demo chat logic (front-end only)
    (function(){
      const chat = document.getElementById('chatPA');
      const msg  = document.getElementById('msgPA');
      const send = document.getElementById('sendPA');

      function addBubble(text, who="user"){
        const wrap = document.createElement('div');
        wrap.className = who === "user" ? "flex justify-end" : "flex";
        const bubble = document.createElement('div');
        bubble.className = (who === "user"
          ? "bg-white text-black"
          : "bg-slate-800/70 text-slate-100")
          + " max-w-[80%] rounded-xl px-3 py-2 text-sm";
        bubble.textContent = text;
        wrap.appendChild(bubble);
        chat.appendChild(wrap);
        chat.scrollTop = chat.scrollHeight;
      }

      async function handleSend(){
        const text = msg.value.trim();
        if (!text) return;
        addBubble(text, "user");
        msg.value = "";
        addBubble("Thinking‚Ä¶");
        // Replace this with your real API later:
        chat.lastChild.firstChild.textContent = "You said: " + text;
      }

      send.addEventListener('click', handleSend);
      msg.addEventListener('keydown', (e)=>{
        if (e.key === 'Enter' && !e.shiftKey) handleSend();
      });
    })();

    // Events
    document.addEventListener('DOMContentLoaded', ()=>{
      loadJobs();
      filterBtn.addEventListener('click', ()=>{
        keyword     = kwInput.value.trim();
        locationStr = locInput.value.trim();
        page = 1; loadJobs();
      });
      resetBtn.addEventListener('click', ()=>{
        kwInput.value=""; locInput.value="";
        keyword=""; locationStr=""; page=1; loadJobs();
      });
      [kwInput,locInput].forEach(inp=>inp.addEventListener('keydown', e=>{
        if (e.key === 'Enter') filterBtn.click();
      }));
      pager.addEventListener('click', (e)=>{
        const b = e.target.closest('button[data-page]');
        if (!b || b.disabled) return;
        page = Number(b.dataset.page);
        loadJobs();
      });
    });
  </script>


<!--Script for user Modal Toggle-->
<script>
  function toggleProfileModal() {
    const modal = document.getElementById('profileModal');
    modal.classList.toggle('hidden');
  }

  // Close if clicked outside
  document.addEventListener('click', (e) => {
    const modal = document.getElementById('profileModal');
    if (!modal.contains(e.target) &&
        !e.target.closest('button[onclick="toggleProfileModal()"]')) {
      modal.classList.add('hidden');
    }
  });
</script>

  <!--To get the name and email id and to show uo un the profile button-->
    <script>
      document.getElementById("displayName").textContent = localStorage.getItem("username");
      document.getElementById("displayEmail").textContent = localStorage.getItem("email");
    </script>

</body>
</html>
